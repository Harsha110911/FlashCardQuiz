<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Civil Dept - Flash Card Quiz</title>
<style>
:root { --panel-w: 760px; }
* { box-sizing: border-box; }
body { margin:0; overflow:hidden; background:#0c0c0c; font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color:#fff; }

/* Falling Civil icons */
.icon { position:absolute; font-size:24px; opacity:0.7; animation:fall 6s linear infinite; z-index:1; user-select:none; }
@keyframes fall { from { transform:translateY(-50px) rotate(0deg); } to { transform:translateY(110vh) rotate(360deg); } }

/* Cinematic panel */
#beforeScreen { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:100; }
.cinematic-panel { background: rgba(255, 255, 255, 0.85); color: #000; border-radius: 80px; padding: 50px 70px; max-width: 750px; text-align: center; box-shadow: 0 10px 35px rgba(0,0,0,0.35); display: inline-block; }
.cinematic-panel h1 { margin:0 0 10px 0; font-size:28px; }
.cinematic-text { font-size:18px; line-height:1.8; margin:10px 0; text-align:left; opacity:0; transition: opacity 0.3s ease; }

/* Buttons */
.button { position:relative; transition:all 0.3s ease-in-out; padding:0.5rem 1.25rem; border-radius:9999px; display:inline-flex; align-items:center; justify-content:center; gap:10px; font-weight:bold; border:3px solid #ffffff4d; cursor:pointer; margin-top:25px; display:none; background:#222; color:#fff; overflow:hidden; }
#backBtn { background-color:#e74c3c; color:white; }
#startQuizBtn { background-color:rgb(0 107 179); color:white; }
.button:hover { transform:scale(1.05); border-color:#fff9; }
.button::before { content:""; position:absolute; width:100px; height:100%; background-image:linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.8), rgba(255,255,255,0) 70%); top:0; left:-100px; opacity:0.6; }
.button:hover::before { animation: shine 1.5s ease-out infinite; }
@keyframes shine { 0%{left:-100px;} 60%{left:100%;} to{left:100%;} }

/* --- Roll Number Modal --- */
#rollModal { position: fixed; top:0; left:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,0.6); z-index:200; display:none; }
.roll-box { background:#fff; padding:30px 40px; border-radius:20px; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.4); }
.roll-box h2 { margin-bottom:15px; color:#333; }
.roll-box input { padding:10px; border-radius:8px; border:2px solid #ccc; width:80%; font-size:16px; margin-bottom:15px; }
.roll-box button { background:#006bb3; color:white; border:none; padding:10px 20px; border-radius:999px; font-weight:bold; cursor:pointer; position: relative; overflow:hidden; margin-top:10px; }
.roll-box button::before { content:""; position:absolute; width:100px; height:100%; background-image: linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.8), rgba(255,255,255,0) 70%); top:0; left:-100px; opacity:0.6; }
.roll-box button:hover::before { animation: shine 1.5s ease-out infinite; }
#userDetails { margin-top:15px; font-weight:bold; color:#333; }
#proceedBtn { display:none; margin-top:10px; }
</style>
</head>
<body>

<!-- Falling Civil icons background -->
<script>
(function makeCivilBackground(){
  const icons = ["‚öíÔ∏è","‚öôÔ∏è","üìê","üèóÔ∏è","üß±"];
  for(let i=0;i<36;i++){
    const span = document.createElement("span");
    span.className="icon";
    span.textContent = icons[Math.floor(Math.random()*icons.length)];
    span.style.left = Math.random()*100 + "vw";
    span.style.animationDuration = (3 + Math.random()*3) + "s";
    span.style.animationDelay = (Math.random()*3) + "s";
    document.body.appendChild(span);
  }
})();
</script>

<!-- Cinematic panel -->
<div id="beforeScreen">
  <div class="cinematic-panel">
    <h1 id="cinematicHeading"></h1>
    <div id="rulesContainer"></div>
    <div style="display:flex; gap:15px; justify-content:center; margin-top:25px;">
      <button class="button" id="backBtn">‚Üê Back</button>
      <button class="button" id="startQuizBtn">Start Quiz ‚Üí</button>
    </div>
  </div>
</div>

<!-- Roll Number Modal -->
<div id="rollModal">
  <div class="roll-box">
    <h2>Enter Your Roll Number</h2>
    <input type="text" id="rollInput" placeholder="e.g. 24F11A0540" />
    <br/>
    <button id="submitRollBtn">Submit</button>
    <button id="proceedBtn">Proceed to Quiz ‚Üí</button>
    <p id="userDetails"></p>
  </div>
</div>

<!-- Supabase Client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// --- Supabase setup ---
const supabaseUrl = "https://vjbdemwrqalpnjbjfsir.supabase.co"; // your project URL
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZqYmRlbXdycWFscG5qYmpmc2lyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMjEzODgsImV4cCI6MjA3MTc5NzM4OH0.yigzQuQcI-MbHSYV04MZFoCp9iAYcIF2cGO2VMFgdfs"; // replace with your anon key
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// --- Typewriter ---
const cinematicHeading = document.getElementById('cinematicHeading');
const rulesContainer = document.getElementById('rulesContainer');
const startBtn = document.getElementById('startQuizBtn');
const backBtn = document.getElementById('backBtn');

function typeWriter(el, text, speed, cb){
  el.innerHTML = '';
  let i=0;
  function typing(){ 
    if(i<text.length){ el.innerHTML+=text.charAt(i); i++; setTimeout(typing,speed);}
    else if(cb) cb();
  }
  typing();
}

const rules = [
  "1. The user will have five questions.",
  "2. For each correct answer, the player will be awarded 2 points.",
  "3. For each incorrect answer, no points will be awarded."
];

typeWriter(cinematicHeading,"Before We Begin",100,function showRules(){
  let index=0;
  function nextRule(){
    if(index<rules.length){
      const p=document.createElement('p');
      p.className='cinematic-text';
      rulesContainer.appendChild(p);
      let i=0;
      function typeLetter(){ 
        if(i<rules[index].length){ p.innerHTML+=rules[index].charAt(i); p.style.opacity="1"; i++; setTimeout(typeLetter,40);}
        else{ index++; setTimeout(nextRule,300);} 
      }
      typeLetter();
    } else { startBtn.style.display='inline-flex'; backBtn.style.display='inline-flex'; }
  }
  nextRule();
});

startBtn.onclick = () => { document.getElementById('rollModal').style.display = "flex"; }
backBtn.onclick = () => { window.location.href = "departments.html"; }

// --- Roll Number Modal with Supabase ---
const rollInput = document.getElementById('rollInput');
const submitBtn = document.getElementById('submitRollBtn');
const proceedBtn = document.getElementById('proceedBtn');
const userDetails = document.getElementById('userDetails');
let currentRollNumber = "";

submitBtn.onclick = async () => {
  const roll_number = rollInput.value.trim().toUpperCase();
  if(!roll_number){ alert("Please enter your roll number."); return; }
  currentRollNumber = roll_number;

  // Check if user exists
  let { data, error } = await supabase.from("users").select("*").eq("roll_number", roll_number).limit(1);
  if(error){ alert("Database Error: " + error.message); return; }

  if(!data || data.length === 0){
    // New user ‚Üí Insert default record
    const { error: insertError } = await supabase.from("users").insert([{ roll_number: roll_number, points: 0, attempts: 5 }]);
    if(insertError){ alert("Insert Error: " + insertError.message); return; }
    userDetails.textContent = `Roll Number: ${roll_number} | Points: 0 | Attempts: 5`;
  } else {
    // Existing user
    userDetails.textContent = `Roll Number: ${roll_number} | Points: ${data[0].points} | Attempts: ${data[0].attempts}`;
  }

  proceedBtn.style.display = "inline-block";
};

proceedBtn.onclick = () => {
  if(!currentRollNumber){ alert("Please submit your roll number first!"); return; }
  localStorage.setItem("rollNumber", currentRollNumber);
  window.location.href = "civil-quiz.html";
};

rollInput.addEventListener("keydown", (e) => { if(e.key==="Enter") submitBtn.click(); });
</script>
</body>
</html>
